+++
title = '第七章 注册功能实现'
date = 2025-11-02T07:47:41+08:00
draft = true
categories = [ "Programming" ]
tags = [ "go", "programming"]
+++

# 1 密码加密

## 1.1 如何加密

加密算法的选择会直接影响你整个系统的安全性，因为攻击者一旦拿到了密码，差不多就可以为所欲为了。

选择加密算法的标准就一个，难破解。你要考虑以下问题：
- 相同的密码，加密后的结果应该不同。你可以预期，很多用户习惯用 123456 这种密码，但是我们希望数据库存储的值还是不一样。
- 难以通过碰撞、彩虹表来破解。

常见的加密算法无非就是下面这些，安全性逐步提高：
1. md5 之类的哈希算法。
2. 在 1 的基础上，引入了盐值(salt），或者进行多次哈希等。
3. PBKDF2、BCrypt 这一类随机盐值的加密算法，同样的文本加密后的结果都不同。

## 1.2 BCrypt 加密

bcrypt 是一个号称最安全的加密算法。bcrypt 加密之后是没办法解密的，所以只能同时比较加密之后的值来确定两者是否相等。

优点：
- 不需要你自己去生成盐值。
- 不需要额外存储盐值。
- 可以通过控制 cost 来控制加密性能。
- 同样的文本，加密后的结果不同。

要是用它，需要使用 golang.org/x/crypto。因为 bcrypt 限制密码长度不能超过 72 字节，所以在校验时要校验这个长度。只需要修改一下正则表达式就可以。

示例：
```go
func TestEncrypt(t *testing.T) {
	password := "123456"
	encrypted, err := bcrypt.GenerateFromPassword([]byte(password), bcrypt.DefaultCost)
	if err != nil {
		t.Fatal(err)
	}
	fmt.Println(string(encrypted))
	err = bcrypt.CompareHashAndPassword(encrypted, []byte(password))
	assert.NoError(t, err)
}
```
