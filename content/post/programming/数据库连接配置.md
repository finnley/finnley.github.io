+++
title = '数据库连接配置'
date = 2025-09-04T20:04:31+08:00
draft = true
categories = [ "Programming" ]
tags = [ "programming", "python", "go" ]
+++

# 数据库连接

**Python**

settings.py
```python
from playhouse.pool import PooledMySQLDatabase
from playhouse.shortcuts import ReconnectMixin


class ReconnectMysqlDatabase(ReconnectMixin, PooledMySQLDatabase):
    pass

MYSQL_DB = "testdb_user_srv"
MYSQL_HOST = "127.0.0.1"
MYSQL_PORT = 3306
MYSQL_USER = "default"
MYSQL_PASSWORD = "secret"

DB = ReconnectMysqlDatabase(MYSQL_DB, host=MYSQL_HOST, port=MYSQL_PORT, user=MYSQL_USER, password=MYSQL_PASSWORD)
```

使用了 连接池，在连接池中如果连接长时间没有使用，会关闭连接，在下次需要使用已关闭的连接时则会出现错误，为了解决这个问题，就需要引入 ReconnectMixin，它可以对已经关闭的连接做重连处理。

models.py
```python
from peewee import *

from user_srv.settings import settings


class BaseModel(Model):
  class Meta:
    database = settings.DB


class User(BaseModel):
  # 用户模型

  GENDER_CHOICES = (
    ("male", "男"),
    ("female", "女")
  )

  ROLE_CHOICES = (
    (1, "普通用户"),
    (2, "管理员")
  )

  mobile = CharField(max_length=11, index=True, unique=True, verbose_name="手机号码")
  password = CharField(max_length=100, verbose_name="密码")
  nick_name = CharField(max_length=20, null=True, verbose_name="昵称")
  head_url = CharField(max_length=200, null=True, verbose_name="头像")
  birthday = DateField(null=True, verbose_name="生日")
  address = CharField(max_length=200, null=True, verbose_name="地址")
  desc = TextField(null=True, verbose_name="个人简介")
  gender = CharField(max_length=6, choices=GENDER_CHOICES, null=True, verbose_name="性别")
  role = IntegerField(default=1, choices=ROLE_CHOICES, verbose_name="用户角色")


if __name__ == '__main__':
  settings.DB.create_tables([User])

```

**Golang**
